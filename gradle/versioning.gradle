def props = new Properties()

props.load(new FileInputStream("$rootProject.projectDir/version.properties"))
props.each({
    project.ext.set(it.key, it.value)
})

ext.buildTimestamp = new Date().format("yyyy-MM-dd HH:mm:ss")

if (System.env.BUILD_NUMBER) {
    ext.buildId = System.env.BUILD_NUMBER
}
else if ("${BUILD_NUMBER}") {
    ext.buildId = "${BUILD_NUMBER}"
}
else {
    ext.buildId = buildTimestamp
}

project.version = new ProjectVersion("${MAJOR_RELEASE_ID}", "${MINOR_RELEASE_ID}", "$buildId")

class ProjectVersion {
    final String major
    final String minor
    final String build

    ProjectVersion(String major, String minor, String build) {
        this.major = major
        this.minor = minor
        this.build = build
    }

    @Override
    String toString() {
        String fullVersion = "$major.$minor"

        if (build) {
            fullVersion += ".$build"
        }

        fullVersion
    }
}